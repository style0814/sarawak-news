name: RSS Cron Refresh

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - name: Skip when secrets are not configured
        if: ${{ secrets.SITE_URL == '' || secrets.CRON_SECRET == '' }}
        run: echo "Skipping RSS refresh: set SITE_URL and CRON_SECRET repository secrets."

      - name: Trigger /api/cron/refresh
        if: ${{ secrets.SITE_URL != '' && secrets.CRON_SECRET != '' }}
        env:
          SITE_URL: ${{ secrets.SITE_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          set -euo pipefail
          BASE_URL="${SITE_URL%/}"
          curl --fail --silent --show-error --max-time 120 \
            -H "Authorization: Bearer ${CRON_SECRET}" \
            "${BASE_URL}/api/cron/refresh"
